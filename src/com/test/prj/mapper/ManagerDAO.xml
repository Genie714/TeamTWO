<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.prj.IManagerDAO">

	<select id="searchId" resultType="com.test.prj.GroupMemberDTO">
		SELECT H.GROUP_ID, H.ID AS MATCH_ID
		FROM TBL_USER T
		JOIN GR_MATCH H
		ON T.ID = H.USER_ID
		LEFT JOIN GR_PREINVITE P
		ON H.ID = P.MEMBER_ID
		LEFT JOIN GR_INVITE I
		ON H.ID = I.RECEPTION_ID
		LEFT JOIN GR_SIGNUP N
		ON H.ID = N.MEMBER_ID
		WHERE T.ID = #{group_id}
		AND (P.SIGNUP_WHETHER_ID = 'SW01'
		OR I.WHETHER_ID = 'SW01'
		OR N.WHETHER_ID = 'SW01')
    </select>
	
	<select id="managerCount" resultType="java.lang.Integer">
		SELECT COUNT(H.ID) AS COUNT
		FROM GR_MATCH H
		RIGHT JOIN GR_MANAGER R
		ON H.ID = R.MATCH_ID
		LEFT JOIN GR_PREINVITE P
		ON H.ID = P.MEMBER_ID
		LEFT JOIN GR_INVITE I
		ON H.ID = I.RECEPTION_ID
		LEFT JOIN GR_SIGNUP N
		ON H.ID = N.MEMBER_ID
		WHERE H.GROUP_ID = #{group_id}
		AND (P.SIGNUP_WHETHER_ID = 'SW01'
		OR I.WHETHER_ID = 'SW01'
		OR N.WHETHER_ID = 'SW01')
	</select>	

	<select id="managerList" resultType="com.test.prj.GroupMemberDTO">
		SELECT I.NAME AS NAME, H.ID AS MATCH_ID
		FROM GR_MANAGER R
		LEFT JOIN GR_MATCH H
		ON R.MATCH_ID = H.ID
		LEFT JOIN GR_PREINVITE P
		ON H.ID = P.MEMBER_ID
		LEFT JOIN GR_INVITE I
		ON H.ID = I.RECEPTION_ID
		LEFT JOIN GR_SIGNUP N
		ON H.ID = N.MEMBER_ID
		JOIN TBL_USER U
		ON H.USER_ID = U.ID
		JOIN US_INFORMATION I
		ON U.ID = I.USER_ID
		WHERE H.GROUP_ID = #{group_id}
		AND (P.SIGNUP_WHETHER_ID = 'SW01'
		OR I.WHETHER_ID = 'SW01'
		OR N.WHETHER_ID = 'SW01')
		ORDER BY I.NAME
	</select>

	<select id="voteList" resultType="com.test.prj.GroupMemberDTO">
		SELECT I.NAME AS NAME, H.ID AS MATCH_ID
		FROM GR_MANAGER R
		RIGHT JOIN GR_MATCH H
		ON R.MATCH_ID = H.ID
		LEFT JOIN GR_PREINVITE P
		ON H.ID = P.MEMBER_ID
		LEFT JOIN GR_INVITE I
		ON H.ID = I.RECEPTION_ID
		LEFT JOIN GR_SIGNUP N
		ON H.ID = N.MEMBER_ID
		JOIN TBL_USER U
		ON H.USER_ID = U.ID
		JOIN US_INFORMATION I
		ON U.ID = I.USER_ID
		WHERE R.MATCH_ID IS NULL
		AND H.GROUP_ID = #{group_id}
		AND (P.SIGNUP_WHETHER_ID = 'SW01'
		OR I.WHETHER_ID = 'SW01'
		OR N.WHETHER_ID = 'SW01')
		ORDER BY I.NAME
	</select>
	
	<select id="searchGrmrVoteeId" resultType="com.test.prj.GroupMemberDTO">
		SELECT E.ID
		FROM GR_MATCH H
		RIGHT JOIN GR_MANAGER_VOTEE E
		ON H.ID = E.VOTEE_ID
		WHERE H.GROUP_ID = #{group_id}
		AND H.ID = #{match_id}
	</select>
	
	<insert id="voteAdd">
		INSERT INTO GR_MANAGER_VOTE(ID, GROUP_ID, START_DATE)
		VALUES(#{id}, #{group_id}, SYSDATE)
	</insert>
	
	<insert id="voteeAdd">
		INSERT INTO GR_MANAGER_VOTEE(ID, VOTE_ID, VOTEE_ID, ALARM_OUTGOING_DATE)
		VALUES(#{id}, #{vote_id}, #{votee_id}, SYSDATE + INTERVAL '1' DAY)
	</insert>

	<insert id="voterAdd">
		INSERT INTO GR_MANAGER_VOTER(ID, VOTE_ID, VOTER_ID, VOTEE_ID, VOTER_DATE)
 		VALUES('VR03', #{vote_id}, #{voter_id}, #{grmrvotee_id}, '2024-09-05 18:30:24')
	</insert>
	
</mapper>